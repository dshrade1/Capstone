#Assign patients their HCCs

# read in the HCC mapping document
map <- read.csv("/project/msca/capstone3/2014_icd_mapping.csv",header=T)
head(map)
names(map)
map <- map[,c(1,3,4,5,6)]
head(map)
names(map) <- c("DIAG","2013.HCC","PACE/ESRD.HCC","2014.HCC","Rx.HCC")

library(sqldf)
#patientHCC<-"select charges_all.*, icd9Dx.icd9_dx from charges_all left join icd9Dx on charges_all.patient_id=icd9Dx.patient_id and charges_all.encounter_id=icd9Dx.encounter_id"
patientHCC<-"select DIAG.*, map.* from DIAG left join map on DIAG.DIAG=map.DIAG"
patientHCC<- sqldf(patientHCC,stringsAsFactors=FALSE) #this works!
nrow(patientHCC) #this is the correct number of rows; should be equal in length to nrow(DIAG), and it is
head(patientHCC) #this works
